# Комментарии к схемам

## Контекстная диаграмма

* На схеме не отражены процессы идентификации, авторизации и аутентификации пользователя в систему PropDevelopment, т.к. на текущий момент эти процессы уже существуют
* На схеме не отражены подробности взаимодействия сервисов партнера с умными устройствами. Считаем, что партнер реализует этот механизм самостоятельно, для нашей схемы это не имеет особого значения
* На схеме нет детализации по конкретным устройствам и сервисам партнера. В целом это нам неважно, главное - общий принцип построения процесса и расположение систем относительно друг друга.

## Диаграмма контейнеров

Что не учтено на схеме:

* системы EDR, SIEM и прочие средства распознавания инцидентов и реагирования на них; в предыдущем задании мы выяснили, что их нет, их внедрение - отдельная задача
* не изображен сервис по защите от DDoS; но предполагаем, что его надо использовать


Также по постановке задачи мы не знаем, как именно работают сервисы "Умный дом" от стороннего вендора: они могут либо запрашивать у нас персональные данные и проверять их соответствие данным, полученным со шлагбаума/домофона самостоятельно; либо запрашивать в PropDevelopment результат такой проверки. Здесь принят второй вариант, т.к. в этом случае хранение персональных данных на нашей стороне, не требуется доп. гарантий при передаче этих данных в стороннюю систему.

Предполагается использовать стратегию DMZ в виде двойного firewall для разграничения обращений из внешней экосистемы в нашу. Т.е. первое обращение для авторизации в DMZ, а далее уже авторизованные запросы в подсеть, содержащую сервисы с персональными данными.

# Требования

## Требования к безопасности

Наиболее чувствительные данные в новой части ландшафта - персональные (фото лица, ассоциированное с профилем, а также номер авто). Соответственно основное требование - обеспечить безопасность этих данных.

Также мы имеем дело с обращениями к нашей инфраструктуре из сервисов внешнего провайдера, причем обращения также за персональными данными. В этом случае важно:

* не позволить злоумышленнику через этот канал получить персональные данные
* в принципе передавать персональные данные в ответ на запрос сервиса не нужно, т.к. для предоставления доступа/отказа достаточно ответа, являются ли переданные данные зарегистрированными в системе
* т.к. обращение автоматическое, то одна из угроз - DDoS атака

Опять же вопрос персональных данных: важное требование - безопасное редактирование пользователем своих персональных данных и их последующее безопасное хранение (шифрование)

## Описание протоколов аутентификации и авторизации

### Аутентификация

Для собственника в мобильном приложении MFA: позволит входить с разных устройств и проверять подлинность пользователя по разным факторам.
Для безопасного обмена данными с экосистемой провайдера умного дома OAuth2.0

### Авторизация

Применить RBAC для пользователей, получающих доступ к данным через мобильное приложение: только собственники могут менять свои персональные данные

Для авторизации из экосистемы умного дома можно применить ABAC, чтобы ограничить передаваемые данные

## Организация взаимодействия между системами предприятия и внешней платформой

1. Сервис умного дома проходит аутентификацию и авторизацию в системе предприятия через firewall
2. После авторизации сервис умного дома запрашивает результат поиска передаваемых им данных в базе предприятия (например, есть ли пользователь с таким номером авто). Для этого запрос через доп. firewall отправляется в сервис персональных данных во внутреннем контуре
3. При получении положительного ответа сервис передает сигнал умному устройству на предоставление доступа (например, открыть шлагбаум)
3.1 При отрицательном ответе устройство получает отказ: пользователь в этом случае сможет воспользоваться традиционным способом доступа, например, по RFID метке

В процессе работы все запросы должны журналироваться.